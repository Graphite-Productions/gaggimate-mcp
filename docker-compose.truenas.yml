# TrueNAS SCALE — paste this into Apps → Discover → Install via YAML
#
# IMPORTANT: Set environment variables in the TrueNAS app configuration UI.
# Do NOT set them in this file — TrueNAS manages env vars separately.
#
# Required environment variables:
#   GAGGIMATE_HOST        - GaggiMate IP address (e.g., 192.168.1.100)
#   NOTION_API_KEY        - Notion integration token (starts with ntn_)
#   NOTION_BREWS_DB_ID    - Notion Brews database ID
#   NOTION_PROFILES_DB_ID - Notion Profiles database ID
#   NOTION_BEANS_DB_ID    - Notion Beans database ID
#
# Optional:
#   GAGGIMATE_PROTOCOL    - ws (default) or wss
#   WEBHOOK_SECRET        - Notion webhook secret
#   POLLING_FALLBACK      - true (default) or false
#   SYNC_INTERVAL_MS      - Shot polling interval in ms (default: 30000)
#   RECENT_SHOT_LOOKBACK_COUNT - Recent shot rows to re-hydrate each poll (default: 5)
#   BREW_TITLE_TIMEZONE   - Timezone for brew title AM/PM labels (e.g. America/Los_Angeles)

services:
  gaggimate-bridge:
    image: ghcr.io/graphite-productions/gaggimate-bridge:latest
    restart: unless-stopped
    ports:
      - "3000:3000"
    volumes:
      - gaggimate-data:/app/data
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3000/health"]
      interval: 30s
      timeout: 5s
      retries: 3

volumes:
  gaggimate-data:
